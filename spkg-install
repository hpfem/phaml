if [ "$SPKG_LOCAL" = "" ]; then
   echo "SPKG_LOCAL undefined ... exiting";
   echo "Maybe run 'femhub --shell'?"
   exit 1
fi

PACKAGE_NAME=phaml

cd src

PY_VER=`python -c "import sys;print '%d.%d' % sys.version_info[:2]"`
echo "Detected Python version: $PY_VER"

cmake -DCMAKE_INSTALL_PREFIX="$SPKG_LOCAL" \
    -DPYTHON_INCLUDE_PATH="$SPKG_LOCAL/include/python$PY_VER" \
    -DPYTHON_LIBRARY="$SPKG_LOCAL/lib/python2.6/config/libpython2.6.dll.a" \
    .
if [ $? -ne 0 ]; then
   echo "Error configuring $PACKAGE_NAME."
   exit 1
fi

make
if [ $? -ne 0 ]; then
   echo "Error building $PACKAGE_NAME."
   exit 1
fi

echo "Installing Phaml into femhub..."
rm -rf "$SPKG_LOCAL/lib/python/site-packages/phaml/"
cp -r phaml "$SPKG_LOCAL/lib/python/site-packages/"
if [ $? -ne 0 ]; then
   echo "Error installing $PACKAGE_NAME."
   exit 1
fi
